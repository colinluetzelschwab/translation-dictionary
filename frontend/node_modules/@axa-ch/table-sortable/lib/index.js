import t from"@axa-ch/table";import{html as e,LitElement as o,css as r,unsafeCSS as a}from"lit";import{unsafeHTML as s}from"lit/directives/unsafe-html.js";var n=(t,e)=>{const o=t.toLowerCase();return window.customElements.get(o)||window.customElements.define(o,e),o};const l=(t,e)=>{return`${t}-${o=e,`${o}`.replace(/\./g,"-").replace(/[^A-Za-z0-9-]/g,"")}`;var o},i=(t,e="",o="<")=>`${o}${e}${t}`,d=(t,e,o)=>i(l(t,e),o,"{"),h=(t,e,o)=>t.map((t=>t.split(i(e)).join(d(e,o)).split(i(e,"/")).join(d(e,o,"/")))),b=(t,e,o)=>{const r="string"==typeof e&&e;let a="";return t.forEach((t=>{const s=t instanceof HTMLElement?t.constructor:t,{tagName:i}=s,d=!r&&e[i];if(d){if(!window.customElements.get(i)&&s.versions)throw Error(`'versions' is a reserved class property, but was found in ${i}'s class`);s.versions=d,n(i,s)}let{versions:h}=s;!h&&o&&(h=e[o.constructor.tagName],h[i]=Object.values(h)[0]);const b=r||h[i];a=l(i,b),n(a,class extends s{})})),a},c=t=>(o,...r)=>{const a=t.constructor,[s,n]=(t=>{const{versions:e,tagName:o}=t,r=Object.keys(e).filter((t=>t!==o)).sort(((t,e)=>e.length-t.length));return[r,r.map((t=>e[t]))]})(a);let l=o;for(let t=0,e=s.length;t<e;t++)l=h(l,s[t],n[t]);for(let t=0,e=l.length;t<e;t++)l[t]=l[t].split("{").join("<");return l.raw=l,e(l,...r)};const p=t=>!(null==t),u=new Map;[[String,""],[Boolean,!1],[Object,{}],[Array,[]],[Number,0],[Function,()=>{}]].forEach((([t,e])=>{u.set(t,e)}));const _=()=>{},m=t=>{const{constructor:{properties:e}}=t;Object.keys(e).forEach((o=>{const r=e[o],{type:a,converter:s,defaultValue:n}=r;if(!a){if(!s)throw new Error(`<${t.nodeName}> property "${o}" is missing a type!`);return}let l=t[o];p(l)||(l=a===Boolean?t.hasAttribute(o):t.getAttribute(o),p(l)?t[o]=((t,e)=>e===Number?parseFloat(t):e===Function?_:e===Array||e===Object?JSON.parse(t):t)(l,a):void 0===n&&"defaultValue"in r||(t[o]="defaultValue"in r?n:u.get(a)))}))};const g="ascending",f="descending",x=[13,32],y=["Space","Enter"],w={[g]:"ASC",[f]:"DESC"};class v extends o{constructor(){super(),this.defaultModel={thead:[],tbody:[[]],tfoot:[[]]},m(this),this.handleOnClick=this.handleOnClick.bind(this),this.sortByIndex=this.sortByIndex.bind(this),this.onKeyPress=this.onKeyPress.bind(this),this.firstRender=!0,this.numCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),this.strCollator=new Intl.Collator(void 0,{sensitivity:"variant"}),this.lastIndex=-1,b([t],{"axa-table-sortable":{"axa-table-sortable":"5.0.2","axa-table":"5.0.2"}},this)}static get tagName(){return"axa-table-sortable"}static get styles(){return r`
      ${a('.o-table-sortable__th__flexcontainer {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n}\n.o-table-sortable__th__arrow {\n  margin-left: 5px;\n  border-left: 4px solid transparent;\n  border-right: 4px solid transparent;\n  width: 0;\n  height: 0;\n  font-size: 0;\n  line-height: 0;\n  content: "";\n  border-style: solid;\n}\n.o-table-sortable__th__arrowup {\n  border-bottom-width: 4px;\n  border-bottom-color: #ccc;\n  border-top: none;\n}\n.o-table-sortable__th__arrowdown {\n  margin-top: 3px;\n  border-top-width: 4px;\n  border-top-color: #ccc;\n  border-bottom: none;\n}\n.o-table-sortable th:not([aria-sort=none]) {\n  cursor: pointer;\n}\n.o-table-sortable th[aria-sort=none] > div.o-table-sortable__th__flexcontainer > div.o-table-sortable__th__arrow-wrapper {\n  display: none;\n}\n.o-table-sortable [tabindex] {\n  cursor: pointer;\n}\n.o-table-sortable th[aria-sort=ascending]:active .o-table-sortable__th__arrow, .o-table-sortable th[aria-sort=ascending]:focus .o-table-sortable__th__arrow {\n  border-top-color: #00008f;\n}\n.o-table-sortable th[aria-sort=ascending].o-table-sortable__th--selected .o-table-sortable__th__arrow {\n  border-bottom-color: #00008f;\n}\n.o-table-sortable th[aria-sort=ascending].o-table-sortable__th--selected .o-table-sortable__th__arrowdown {\n  display: none;\n}\n.o-table-sortable th[aria-sort=descending]:active .o-table-sortable__th__arrow, .o-table-sortable th[aria-sort=descending]:focus .o-table-sortable__th__arrow {\n  border-bottom-color: #00008f;\n}\n.o-table-sortable th[aria-sort=descending].o-table-sortable__th--selected .o-table-sortable__th__arrow {\n  border-top-color: #00008f;\n}\n.o-table-sortable th[aria-sort=descending].o-table-sortable__th--selected .o-table-sortable__th__arrowup {\n  display: none;\n}')}
    `}static get properties(){return{model:{type:Object,defaultValue:{...this.defaultModel}},innerscroll:{type:Number},maxheight:{type:Number},dateSortColumnIndex:{type:String},onClick:{type:Function,attribute:!1}}}areValuesEqualOrZero(t,e){return t===e||(0===t||0===e)}areLengthValuesConsistent(t=0,e=0,o=0){return e===t&&t===o||(0!==t||!(e>0||o>0))&&(0===e?this.areValuesEqualOrZero(t,o):0===t?this.areValuesEqualOrZero(e,o):0===o&&this.areValuesEqualOrZero(e,t))}validateModel(){const{thead:{length:t},tbody:{0:{length:e}},tfoot:o}=this.model;let r=0;return o&&o[0]&&(r=o[0].length),this.areLengthValuesConsistent(e,t,r)}sortByIndex(t,e){const o=this.getSortingAria(e);if("none"!==o){const r=o===g?f:g,a={...this.model},{tbody:s,tfoot:n}=this.model;a.tbody=this.sort(s,t,r,e.key),n&&n[0]?a.tfoot=this.sort(n,t,r,e.key):a.tfoot=[[]],a.thead[t].sort=w[r],this.lastIndex=t,this.model=a}}getSortingAria(t){return t.sort?"DESC"===t.sort?f:g:"none"}sort(t,e,o,r){const a=this.dateSortColumnIndex.split(",").map((t=>{const e=parseInt(t,10);return isNaN(e)?void 0:e}));return t.sort(((t,s)=>{const n=(t="")=>t.replace(/<[^>]*>/g,"").trim(),l=r?s[e][r]:n(s[e].html)||s[e].text,i=r?t[e][r]:n(t[e].html)||t[e].text,d=t=>o===g?t:-t;let h;if(this.dateSortColumnIndex&&a.includes(e)){const t=this.convertDateToUnixEpochInteger(i),e=this.convertDateToUnixEpochInteger(l);return h=this.numCollator.compare(t,e),d(h)}return h=isNaN(parseInt(i.charAt(0),10))?this.strCollator.compare(i,l):this.numCollator.compare(i,l),d(h)}))}convertDateToUnixEpochInteger(t){const e=t.split(/[./-]/),o=(t,e)=>{const o=Math.abs(parseInt(t,10)),r=o.toString().length;return`${(10**Math.max(0,e-r)).toString().slice(1)}${o}`};return Date.parse(`${o(e[2],4)}-${o(e[1],2)}-${o(e[0],2)}T00:00:00`)}shouldUpdate(...t){if(this.firstRender&&(this.firstRender=!1,this.model={...this.defaultModel,...this.model}),!this.validateModel())throw new Error("Invalid model provided");return super.shouldUpdate(...t)}handleOnClick(t,e,o){t.preventDefault(),t.stopPropagation();const{currentTarget:r}=t,a=r.textContent.replace(/\s+/g," ").trim(),s={type:o,index:e,domElement:r,textArray:a.split(" ")};this.onClick(s),((t,e,o,{bubbles:r=!0,composed:a=!0}={})=>{const s=new CustomEvent(t,{detail:e,bubbles:r,composed:a});o.dispatchEvent(s)})("click",s,this,{bubbles:!1})}onKeyPress(...t){const{0:{charCode:e,code:o}}=t;(x.indexOf(e)>-1||y.indexOf(o)>-1)&&this.handleOnClick(...t)}render(){const{thead:t,tbody:o,tfoot:r}=this.model;return c(this)`
      <axa-table
        class="o-table-sortable js-table"
        maxheight="${this.maxheight}"
        innerscroll="${this.innerscroll}"
      >
        <table>
          <thead>
            <tr>
              ${t&&t.map(((t,o)=>e`
                    <th
                      class="${this.lastIndex===o?"o-table-sortable__th--selected":""}"
                      @click="${()=>this.sortByIndex(o,t)}"
                      aria-sort="${this.getSortingAria(t)}"
                    >
                      <div class="o-table-sortable__th__flexcontainer">
                        <span>${t.html}</span>
                        <div class="o-table-sortable__th__arrow-wrapper">
                          <div
                            class="o-table-sortable__th__arrow o-table-sortable__th__arrowup"
                          ></div>
                          <div
                            class="o-table-sortable__th__arrow o-table-sortable__th__arrowdown"
                          ></div>
                        </div>
                      </div>
                    </th>
                  `))}
            </tr>
          </thead>
          <tbody>
            ${o&&o.map(((t,o)=>e`
                  <tr
                    tabindex="0"
                    @click=${t=>{this.handleOnClick(t,o,"tbody")}}
                    @keypress=${t=>{this.onKeyPress(t,o,"tbody")}}
                  >
                    ${t&&t.map((t=>e`
                        <td>
                          ${t.html?s(t.html):t.text}
                        </td>
                      `))}
                  </tr>
                `))}
          </tbody>
          ${r?e`
                  <tfoot>
                    ${o&&r.map(((t,o)=>e`
                        <tr
                          tabindex="0"
                          @click=${t=>{this.handleOnClick(t,o,"tfoot")}}
                          @keypress=${t=>{this.onKeyPress(t,o,"tfoot")}}
                        >
                          ${t&&t.map((t=>e` <td>${s(t.html)}</td> `))}
                        </tr>
                      `))}
                  </tfoot>
                `:""}
        </table>
      </axa-table>
    `}}b([v],{"axa-table-sortable":{"axa-table-sortable":"5.0.2","axa-table":"5.0.2"}});export{v as default};
